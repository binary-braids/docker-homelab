name: docker-volume-backup

networks:
  isolated:
    name: isolated

volumes:
  home-assistant-data:
    external: true
  prometheus-data:
    external: true
  grafana-data:
    external: true
  alertmanager-data:
    external: true
  komodo-db-postgres-data:
    external: true
  komodo-db-ferretdb-data:
    external: true
  komodo-core-data:
    external: true

services:
  docker-volume-backup:
    image: "offen/docker-volume-backup:v2.44.0@sha256:fcf92e0f192214ccda0a89f989bed6c49d4ed77da4e59b38ddfcf05a05512337"
    container_name: docker-volume-backup
    restart: always
    networks:
      - isolated
    environment:
      - AWS_ENDPOINT=minio.binarybraids.com
      - AWS_S3_BUCKET_NAME=docker-volume-backups
      - AWS_ACCESS_KEY_ID=${MINIO_DOCKER_VOLUME_BACKUP_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${MINIO_DOCKER_VOLUME_BACKUP_SECRET_ACCESS_KEY}
      - BACKUP_RETENTION_DAYS=7
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - home-assistant-data:/backup/home-assistant-data:ro
      - prometheus-data:/backup/prometheus-data:ro
      - grafana-data:/backup/grafana-data:ro
      - alertmanager-data:/backup/alertmanager-data:ro
      - komodo-db-postgres-data:/backup/komodo-db-postgres-data:ro
      - komodo-db-ferretdb-data:/backup/komodo-db-ferretdb-data:ro
      - komodo-core-data:/backup/komodo-core-data:ro
